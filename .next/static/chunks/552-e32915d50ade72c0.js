(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{552:function(e,t,a){"use strict";var s=a(7437),n=a(2265),r=a(3281),o=a.n(r),l=a(8966),i=a(8904);let c=e=>{let{text:t}=e;return(0,s.jsx)("div",{className:o().userMessage,children:t})},u=e=>{let{text:t}=e;return(0,s.jsx)("div",{className:o().assistantMessage,children:(0,s.jsx)(i.U,{children:t})})},d=e=>{let{text:t}=e;return(0,s.jsx)("div",{className:o().codeMessage,children:t.split("\n").map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{children:"".concat(t+1,". ")}),e]},t))})},p=e=>{let{role:t,text:a}=e;switch(t){case"user":return(0,s.jsx)(c,{text:a});case"assistant":return(0,s.jsx)(u,{text:a});case"code":return(0,s.jsx)(d,{text:a});default:return null}};t.Z=e=>{let{functionCallHandler:t=()=>Promise.resolve("")}=e,[a,r]=(0,n.useState)(""),[i,c]=(0,n.useState)([]),[u,d]=(0,n.useState)(!1),[h,_]=(0,n.useState)(""),m=(0,n.useRef)(null),x=()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{x()},[i]),(0,n.useEffect)(()=>{(async()=>{let e=await fetch("/api/assistants/threads",{method:"POST"});_((await e.json()).threadId)})()},[]);let f=async e=>{d(!0);let t=await fetch("/api/assistants/threads/".concat(h,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});if(!t.ok){console.error("Error sending message:",t.statusText),d(!1);return}if(null===t.body){console.error("Response body is null. Unable to create a readable stream."),d(!1);return}w(l.c.fromReadableStream(t.body))},b=()=>E("assistant",""),v=e=>{null!=e.value&&N(e.value),null!=e.annotations&&M(e.annotations)},g=e=>{N("\n![".concat(e.file_id,"](/api/files/").concat(e.file_id,")\n"))},y=e=>{"code_interpreter"==e.type&&E("code","")},j=(e,t)=>{var a;"code_interpreter"==e.type&&(null===(a=e.code_interpreter)||void 0===a?void 0:a.input)&&N(e.code_interpreter.input)},C=async e=>{let a=e.data.id,s=e.data.required_action.submit_tool_outputs.tool_calls,n=await Promise.all(s.map(async e=>({output:await t(e),tool_call_id:e.id})));d(!0),await T(a,n)},S=()=>d(!1),w=e=>{e.on("textCreated",b),e.on("textDelta",v),e.on("imageFileDone",g),e.on("toolCallCreated",y),e.on("toolCallDelta",j),e.on("event",e=>{"thread.run.requires_action"===e.event&&C(e),"thread.run.completed"===e.event&&S()})},N=e=>{c(t=>{let a=t[t.length-1],s={...a,text:a.text+e};return[...t.slice(0,-1),s]})},E=(e,t)=>{c(a=>[...a,{role:e,text:t}])},M=e=>{c(t=>{let a={...t[t.length-1]};return e.forEach(e=>{"file_path"===e.type&&e.file_path&&(a.text=a.text.replaceAll(e.text,"/api/files/".concat(e.file_path.file_id)))}),[...t.slice(0,-1),a]})},T=async(e,t)=>{let a=await fetch("/api/assistants/threads/".concat(h,"/actions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({runId:e,toolCallOutputs:t})});if(!a.ok){console.error("Error submitting action result:",a.statusText);return}if(null===a.body){console.error("Response body is null. Unable to create a readable stream.");return}w(l.c.fromReadableStream(a.body))};return(0,s.jsxs)("div",{className:o().chatContainer,children:[(0,s.jsxs)("div",{className:o().messages,children:[i.map((e,t)=>(0,s.jsx)(p,{role:e.role,text:e.text},t)),(0,s.jsx)("div",{ref:m})]}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&(f(a),c(e=>[...e,{role:"user",text:a}]),r(""))},className:"".concat(o().inputForm," ").concat(o().clearfix),children:[(0,s.jsx)("input",{type:"text",className:o().input,value:a,onChange:e=>r(e.target.value),placeholder:"Enter your question",disabled:u}),(0,s.jsx)("button",{type:"submit",className:o().button,disabled:u,children:"Send"})]})]})}},3281:function(e){e.exports={chatContainer:"chat_chatContainer__uCE53",inputForm:"chat_inputForm__mfg3w",input:"chat_input__hTFIv",button:"chat_button__XH0Gl",messages:"chat_messages__C__xG",userMessage:"chat_userMessage__xLvbe",assistantMessage:"chat_assistantMessage__rdpnJ",codeMessage:"chat_codeMessage__djeQF"}}}]);